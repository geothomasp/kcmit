declarels_doc_typ_id VARCHAR2(40);begin  --UMB added max()select max(DOC_TYP_ID) into ls_doc_typ_id from KREW_DOC_TYP_T where DOC_TYP_NM='AwardDocument';INSERT INTO KREW_DOC_HDR_T(DOC_HDR_ID,DOC_TYP_ID,DOC_HDR_STAT_CD,RTE_LVL,STAT_MDFN_DT,CRTE_DT,APRV_DT,FNL_DT,RTE_STAT_MDFN_DT,TTL,APP_DOC_ID,DOC_VER_NBR,INITR_PRNCPL_ID,VER_NBR,RTE_PRNCPL_ID,DTYPE,OBJ_ID,APP_DOC_STAT,APP_DOC_STAT_MDFN_DT)select a.document_number,ls_doc_typ_id,'F',0,sysdate,a.UPDATE_TIMESTAMP,sysdate,NULL,sysdate,('AwardDocument'||'-'||a.AWARD_NUMBER) TTL,NULL,1,nvl(p.PRNCPL_ID,'unknownuser'),1,NULL,NULL,SYS_GUID(),NULL,NULL from AWARD a INNER JOIN TEMP_TAB_TO_SYNC_AWARD t ON a.AWARD_NUMBER = replace(t.MIT_AWARD_NUMBER,'-','-00') and a.SEQUENCE_NUMBER=t.SEQUENCE_NUMBER left outer join KRIM_PRNCPL_T p on LOWER(p.PRNCPL_NM)=LOWER(a.UPDATE_USER)where t.FEED_TYPE='N';         commit;end;/INSERT INTO KRNS_DOC_HDR_T(DOC_HDR_ID,OBJ_ID,VER_NBR,FDOC_DESC,ORG_DOC_HDR_ID,TMPL_DOC_HDR_ID,EXPLANATION)select a.document_number,SYS_GUID(),1,a.AWARD_NUMBER,NULL,NULL,NULL from AWARD aINNER JOIN TEMP_TAB_TO_SYNC_AWARD t ON a.AWARD_NUMBER=replace(t.MIT_AWARD_NUMBER,'-','-00') and a.SEQUENCE_NUMBER=t.SEQUENCE_NUMBER  where t.FEED_TYPE='N' ;commit;INSERT INTO KREW_DOC_HDR_CNTNT_T(DOC_HDR_ID,DOC_CNTNT_TXT)select a.document_number,NULL from AWARD a INNER JOIN TEMP_TAB_TO_SYNC_AWARD t ON a.AWARD_NUMBER=replace(t.MIT_AWARD_NUMBER,'-','-00') and a.SEQUENCE_NUMBER=t.SEQUENCE_NUMBER  where t.FEED_TYPE='N'; commit;INSERT INTO KREW_RTE_BRCH_T(RTE_BRCH_ID,NM,PARNT_ID,INIT_RTE_NODE_INSTN_ID,SPLT_RTE_NODE_INSTN_ID,JOIN_RTE_NODE_INSTN_ID,VER_NBR)select RTE_BRCH_ID,'PRIMARY',NULL,NULL,NULL,NULL,1 from TEMP_KREW_SYNC where MODULE='AWD';commit;/declarels_doc_typ_id VARCHAR2(40);begin  --UMB added max()select max(DOC_TYP_ID) into ls_doc_typ_id from KREW_DOC_TYP_T where DOC_TYP_NM='AwardDocument';INSERT INTO KREW_RTE_NODE_T(RTE_NODE_ID,DOC_TYP_ID,NM,TYP,RTE_MTHD_NM,RTE_MTHD_CD,FNL_APRVR_IND,MNDTRY_RTE_IND,ACTVN_TYP,BRCH_PROTO_ID,VER_NBR,CONTENT_FRAGMENT,GRP_ID,NEXT_DOC_STAT)select RTE_NODE_ID,ls_doc_typ_id,'Initiated','org.kuali.rice.kew.engine.node.InitialNode',null,null,0,	0,'P',null,1,null,null,null from TEMP_KREW_SYNC where MODULE='AWD';commit;end;/INSERT INTO KREW_INIT_RTE_NODE_INSTN_T(DOC_HDR_ID,RTE_NODE_INSTN_ID)select DOCUMENT_NUMBER,RTE_NODE_INSTN_ID from TEMP_KREW_SYNC where MODULE='AWD' ;commit;INSERT INTO KREW_RTE_NODE_INSTN_T(RTE_NODE_INSTN_ID,DOC_HDR_ID,RTE_NODE_ID,BRCH_ID,PROC_RTE_NODE_INSTN_ID,ACTV_IND,CMPLT_IND,INIT_IND,VER_NBR)select RTE_NODE_INSTN_ID,DOCUMENT_NUMBER,RTE_NODE_ID,RTE_BRCH_ID,NULL,1,0,0,1 from TEMP_KREW_SYNC where MODULE='AWD' ;commit;INSERT INTO KREW_ACTN_RQST_T(ACTN_RQST_ID,PARNT_ID,ACTN_RQST_CD,DOC_HDR_ID,RULE_ID,STAT_CD,RSP_ID,PRNCPL_ID,ROLE_NM,QUAL_ROLE_NM,QUAL_ROLE_NM_LBL_TXT,RECIP_TYP_CD,PRIO_NBR,RTE_TYP_NM,RTE_LVL_NBR,RTE_NODE_INSTN_ID,ACTN_TKN_ID,DOC_VER_NBR,CRTE_DT,RSP_DESC_TXT,FRC_ACTN,ACTN_RQST_ANNOTN_TXT,DLGN_TYP,APPR_PLCY,CUR_IND,VER_NBR,GRP_ID,RQST_LBL)select KREW_ACTN_RQST_S.NEXTVAL,NULL,'C',k.DOC_HDR_ID,NULL,'A',-3,k.INITR_PRNCPL_ID,NULL,NULL,NULL,'U',0,NULL,0,t.RTE_NODE_INSTN_ID,NULL,1,SYSDATE,'Initiator needs to complete document.',1,NULL,NULL,'F',1	,0,NULL,NULL from KREW_DOC_HDR_T k inner join TEMP_KREW_SYNC t on k.DOC_HDR_ID=t.DOCUMENT_NUMBER where k.TTL like 'AwardDocument%' AND t.MODULE='AWD' ;commit;INSERT INTO KREW_ACTN_TKN_T(ACTN_TKN_ID,DOC_HDR_ID,PRNCPL_ID,DLGTR_PRNCPL_ID,ACTN_CD,ACTN_DT,DOC_VER_NBR,ANNOTN,CUR_IND,VER_NBR,DLGTR_GRP_ID)select KREW_ACTN_TKN_S.NEXTVAL,k.DOC_HDR_ID,k.INITR_PRNCPL_ID,NULL,'S',SYSDATE,1,NULL,1,1,NULL from KREW_DOC_HDR_T k inner join TEMP_KREW_SYNC t on k.DOC_HDR_ID=t.DOCUMENT_NUMBER where k.TTL like 'AwardDocument%' AND t.MODULE='AWD' ;commit/declarels_doc_typ_id VARCHAR2(40);li_need_insert number;li_count number:=0;cursor c_awd isselect a.award_number , max(a.sequence_number) sequence_number from award aINNER JOIN TEMP_TAB_TO_SYNC_AWARD t ON a.AWARD_NUMBER=replace(t.MIT_AWARD_NUMBER,'-','-00') and a.SEQUENCE_NUMBER=t.SEQUENCE_NUMBER  where t.FEED_TYPE='N'  group by award_number;r_awd c_awd%ROWTYPE;begin  li_need_insert := 1;	begin     -- UMB added max() below	   select max(DOC_TYP_ID) into ls_doc_typ_id from KREW_DOC_TYP_T where DOC_TYP_NM='AwardDocument';  	exception	when others then	li_need_insert := 0;	end;if li_need_insert = 1 then      open c_awd;    loop    fetch c_awd into r_awd;    exit when c_awd%notfound;    /*      update krew_doc_hdr_t set DOC_HDR_STAT_CD = 'F' where      DOC_HDR_ID = (select document_number from award where award_number =  r_awd.award_number and sequence_number =  r_awd.sequence_number)      and DOC_TYP_ID =ls_doc_typ_id;      */      update award set AWARD_SEQUENCE_STATUS = 'ACTIVE' where award_number =  r_awd.award_number and sequence_number =  r_awd.sequence_number;     li_count := li_count + 1;     commit;        end loop;    close c_awd;end if;dbms_output.put_line('update count is '||li_count);end;/